<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîí Secure Test Environment Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .header-title h1 {
      font-size: 28px;
      color: #333;
    }

    .status-badge {
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      background: #e8f5e9;
      color: #2e7d32;
    }

    .timer-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
    }

    .timer {
      font-size: 24px;
      font-weight: 700;
      color: #f44336;
      font-family: 'Courier New', monospace;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
      margin-bottom: 20px;
    }

    .question-box {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .question-header {
      font-size: 18px;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 20px;
    }

    .question-text {
      font-size: 20px;
      color: #333;
      margin-bottom: 24px;
      line-height: 1.6;
    }

    .answer-input, .answer-textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .answer-input:focus, .answer-textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .answer-textarea {
      resize: vertical;
      min-height: 120px;
    }

    .log-viewer {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-height: 600px;
      overflow-y: auto;
    }

    .log-viewer h3 {
      margin-bottom: 16px;
      color: #333;
    }

    .log-entry {
      padding: 8px;
      border-bottom: 1px solid #f0f0f0;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
    }

    .log-type {
      font-weight: 600;
      color: #667eea;
      font-family: 'Courier New', monospace;
    }

    .log-time {
      color: #999;
      font-size: 11px;
    }

    .instructions {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .instructions h3 {
      margin-bottom: 16px;
      color: #333;
    }

    .instructions ul {
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 8px;
      color: #666;
      line-height: 1.6;
    }

    .buttons {
      margin-top: 24px;
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      padding: 14px 16px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideIn 0.3s ease-out;
    }

    .toast-warning {
      border-left: 4px solid #ff9800;
      background: #fff8e1;
    }

    .toast-icon {
      font-size: 20px;
    }

    .toast-message {
      flex: 1;
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 1024px) {
      .content {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="toast-container" id="toastContainer"></div>

  <div class="container">
    <div class="header">
      <div class="header-title">
        <h1>üîí Secure Test Environment Demo</h1>
        <span class="status-badge" id="statusBadge">üîê Protected</span>
      </div>
      <div class="timer-section">
        <div>
          <span style="color: #666; font-size: 14px;">Time Remaining: </span>
          <span class="timer" id="timer">30:00</span>
        </div>
        <div style="color: #666; font-size: 14px;">
          Question <span id="currentQ">1</span> of <span id="totalQ">4</span>
        </div>
      </div>
    </div>

    <div class="content">
      <div class="question-box">
        <div class="question-header">Question <span id="qNum">1</span></div>
        <div class="question-text" id="questionText">
          What is the capital of France?
        </div>
        <textarea 
          class="answer-textarea" 
          id="answerInput"
          placeholder="Type your answer here..."
        ></textarea>
        <div class="buttons">
          <button class="btn btn-secondary" id="prevBtn">‚Üê Previous</button>
          <button class="btn btn-primary" id="nextBtn">Next ‚Üí</button>
          <button class="btn btn-primary" id="exportBtn">üì• Export Logs</button>
        </div>
      </div>

      <div class="log-viewer">
        <h3>üìä Event Log Viewer</h3>
        <div id="logList"></div>
      </div>
    </div>

    <div class="instructions">
      <h3>‚ö†Ô∏è Test Instructions</h3>
      <ul>
        <li>Copy, paste, and cut operations are disabled</li>
        <li>Right-click context menu is disabled</li>
        <li>Text selection is limited (works in answer fields only)</li>
        <li>All actions are logged for audit purposes</li>
        <li>Try to copy this text - you'll see a warning!</li>
      </ul>
    </div>
  </div>

  <script>
    // Event Logger Class
    class EventLogger {
      constructor() {
        this.attemptId = `attempt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        this.eventQueue = [];
        this.logs = [];
        this.metadata = this.captureMetadata();
      }

      captureMetadata() {
        return {
          browser: this.getBrowserInfo(),
          userAgent: navigator.userAgent,
          screenResolution: `${window.screen.width}x${window.screen.height}`,
          platform: navigator.platform,
          language: navigator.language,
        };
      }

      getBrowserInfo() {
        const ua = navigator.userAgent;
        if (ua.indexOf('Chrome') > -1 && ua.indexOf('Edg') === -1) return 'Chrome';
        if (ua.indexOf('Safari') > -1 && ua.indexOf('Chrome') === -1) return 'Safari';
        if (ua.indexOf('Firefox') > -1) return 'Firefox';
        if (ua.indexOf('Edg') > -1) return 'Edge';
        return 'Unknown';
      }

      logEvent(eventType, additionalData = {}, questionId = null) {
        const event = {
          eventType,
          timestamp: Date.now(),
          attemptId: this.attemptId,
          questionId,
          metadata: {
            ...this.metadata,
            focusState: document.hasFocus(),
            tabVisible: !document.hidden,
            ...additionalData,
          },
        };

        this.logs.push(event);
        this.updateLogViewer();
        console.log(`[Event Logged] ${eventType}`, event);
        return event;
      }

      updateLogViewer() {
        const logList = document.getElementById('logList');
        const recentLogs = this.logs.slice(-10).reverse();
        
        logList.innerHTML = recentLogs.map(log => `
          <div class="log-entry">
            <span class="log-type">${log.eventType}</span>
            <span class="log-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
          </div>
        `).join('');
      }

      exportLogs() {
        const exportData = {
          attemptId: this.attemptId,
          exportTimestamp: Date.now(),
          totalEvents: this.logs.length,
          events: this.logs,
        };
        
        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `test-logs-${this.attemptId}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        showToast('üì• Logs exported successfully!');
      }
    }

    // Browser Enforcement Class
    class BrowserEnforcement {
      constructor(logger) {
        this.logger = logger;
        this.currentQuestionId = 'q1';
      }

      activate() {
        // Keyboard events
        document.addEventListener('keydown', this.handleKeyDown, true);
        
        // Context menu
        document.addEventListener('contextmenu', this.handleContextMenu, true);
        
        // Selection
        document.addEventListener('selectstart', this.handleSelectStart, true);
        
        // Clipboard events
        document.addEventListener('copy', this.handleCopy, true);
        document.addEventListener('paste', this.handlePaste, true);
        document.addEventListener('cut', this.handleCut, true);

        // Apply CSS
        this.applyStyles();
        
        this.logger.logEvent('browser_enforcement_activated');
        console.log('[Browser Enforcement] Activated');
      }

      handleKeyDown = (event) => {
        const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
        const ctrlKey = isMac ? event.metaKey : event.ctrlKey;
        const key = event.key.toLowerCase();

        if (ctrlKey && key === 'c') {
          event.preventDefault();
          event.stopPropagation();
          this.logger.logEvent('copy_attempt', { key: 'C', modifier: isMac ? 'Cmd' : 'Ctrl' }, this.currentQuestionId);
          showToast('‚ö†Ô∏è Copying is disabled during the test');
          return false;
        }

        if (ctrlKey && key === 'v') {
          event.preventDefault();
          event.stopPropagation();
          this.logger.logEvent('paste_attempt', { key: 'V', modifier: isMac ? 'Cmd' : 'Ctrl' }, this.currentQuestionId);
          showToast('‚ö†Ô∏è Pasting is disabled during the test');
          return false;
        }

        if (ctrlKey && key === 'x') {
          event.preventDefault();
          event.stopPropagation();
          this.logger.logEvent('cut_attempt', { key: 'X', modifier: isMac ? 'Cmd' : 'Ctrl' }, this.currentQuestionId);
          showToast('‚ö†Ô∏è Cutting is disabled during the test');
          return false;
        }
      };

      handleContextMenu = (event) => {
        event.preventDefault();
        event.stopPropagation();
        this.logger.logEvent('right_click_attempt', { targetElement: event.target.tagName }, this.currentQuestionId);
        showToast('‚ö†Ô∏è Right-click is disabled during the test');
        return false;
      };

      handleSelectStart = (event) => {
        const isInput = event.target.tagName === 'INPUT' || 
                       event.target.tagName === 'TEXTAREA' ||
                       event.target.contentEditable === 'true';
        
        if (!isInput) {
          event.preventDefault();
          event.stopPropagation();
          this.logger.logEvent('text_selection_attempt', { targetElement: event.target.tagName }, this.currentQuestionId);
          return false;
        }
      };

      handleCopy = (event) => {
        event.preventDefault();
        this.logger.logEvent('copy_event', { targetElement: event.target.tagName }, this.currentQuestionId);
        showToast('‚ö†Ô∏è Copying is disabled during the test');
        return false;
      };

      handlePaste = (event) => {
        event.preventDefault();
        this.logger.logEvent('paste_event', { targetElement: event.target.tagName }, this.currentQuestionId);
        showToast('‚ö†Ô∏è Pasting is disabled during the test');
        return false;
      };

      handleCut = (event) => {
        event.preventDefault();
        this.logger.logEvent('cut_event', { targetElement: event.target.tagName }, this.currentQuestionId);
        showToast('‚ö†Ô∏è Cutting is disabled during the test');
        return false;
      };

      applyStyles() {
        const style = document.createElement('style');
        style.id = 'browser-enforcement-styles';
        style.textContent = `
          body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
          }
          
          input, textarea, [contenteditable="true"] {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
          }
        `;
        document.head.appendChild(style);
      }
    }

    // Toast Notification Function
    function showToast(message, type = 'warning') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-icon">‚ö†Ô∏è</div>
        <div class="toast-message">${message}</div>
      `;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Initialize
    const logger = new EventLogger();
    const enforcement = new BrowserEnforcement(logger);
    enforcement.activate();

    // Timer
    let timeRemaining = 1800; // 30 minutes
    const timerEl = document.getElementById('timer');
    
    setInterval(() => {
      if (timeRemaining > 0) {
        timeRemaining--;
        const mins = Math.floor(timeRemaining / 60);
        const secs = timeRemaining % 60;
        timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }
    }, 1000);

    // Export button
    document.getElementById('exportBtn').addEventListener('click', () => {
      logger.exportLogs();
    });

    // Log test start
    logger.logEvent('test_started', { totalQuestions: 4, timeLimit: 1800 });

    // Track visibility changes
    document.addEventListener('visibilitychange', () => {
      logger.logEvent('tab_visibility_change', { visible: !document.hidden });
    });

    window.addEventListener('focus', () => {
      logger.logEvent('window_focus', { focusState: true });
    });

    window.addEventListener('blur', () => {
      logger.logEvent('window_blur', { focusState: false });
    });

    // Track answer changes
    document.getElementById('answerInput').addEventListener('input', (e) => {
      logger.logEvent('answer_updated', { answerLength: e.target.value.length }, enforcement.currentQuestionId);
    });

    console.log('üîí Secure Test Environment Active');
    console.log('Attempt ID:', logger.attemptId);
  </script>
</body>
</html>
